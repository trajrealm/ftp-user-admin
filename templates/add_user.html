<!-- templates/add_user.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Add User</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">    
</head>
<body>
    <div class="container my-5">
        <h2 class="text-center">Add New User</h2>
        <br/><br/>
        <form action="/add" method="post" onsubmit="disableButtons();">
            <div class="row mb-3">
                <label for="username" class="col-sm-2 col-form-label">Username</label>
                <div class="col-sm-5">
                  <input type="text" id="username" name="username" class="form-control" placeholder="Username" required>
                </div>
            </div>
              
            <div class="row mb-3">
                <label for="password" class="col-sm-2 col-form-label">Password</label>
                <div class="col-sm-5">
                  <input type="text" id="password" name="password" class="form-control" placeholder="Autogenerated" readonly>
                </div>
            </div>

            <div class="row mb-3">
                <label for="expiry" class="col-sm-2 col-form-label">Expiry Date</label>
                <div class="col-sm-2">
                  <input type="date" id="expiry" name="expiry" class="form-control" placeholder="YYYY-MM-DD" required>
                </div>
            </div>

            <div class="mb-3">
                <label class="form-label">Datasets</label>
                <div class="row">
                    {% for dataset in datasets %}
                        <div class="col-md-4">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="datasets" value="{{ dataset }}">
                                <label class="form-check-label">{{ dataset }}</label>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
            <button type="submit" class="btn btn-primary" id="createUserBtn">Create User</button>
            <a href="/" class="btn btn-secondary" id="cancelBtn">Cancel</a>

            {% if error %}    
            </br>
            <div class="alert alert-danger">{{ error }}</div>
            {% endif %}            
        </form>

        {% if user_link %}
        <div class="mt-4">
            <p>The user has been created successfully</p>
            <p>Username: {{ username }}</p>
            <p>Password: {{ password }}</p>
            <p>Expiry: {{ expiry }}</p>
            <p>Datasets: {{ selected_datasets }}</p>
            <p>Download link: <a href="{{ user_link }}" target="_blank">{{ user_link }}</a></p>
        </div>
        {% endif %}

    </div>
</body>
<script>
    function disableButtons() {
        const createUserBtn = document.getElementById('createUserBtn');
        createUserBtn.disabled = true;
        createUserBtn.innerText = 'Creating...';

        const cancelBtn = document.getElementById('cancelBtn');
        cancelBtn.classList.add('disabled')
        cancelBtn.onclick = function() {return false; };
    }
</script>

</html>
